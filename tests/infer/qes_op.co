// RUN: choreo -i %s | FileCheck --match-full-lines %s
// RUN: choreo -vn --simplify-fp-valno %s | FileCheck --check-prefix=VALNO --match-full-lines %s

#include "choreo.h"

__co__ void qes_op(int u_x, int u_y, float _f, double _d) {
  bool f = false;
  bool t = true;

  // c for constant
  // u for unknown

  int c_x = 10;
  int c_y = 10;
  int c_z = 200;

  int a = 0;
  int b = 1;

  int c_0 = (c_x > c_z) ? a : b;
  int c_1 = (c_x < c_z) ? a : b;
  int c_2 = (c_x == c_y) ? a : b;
  int c_3 = (c_x != c_z) ? a : b;
  int c_4 = (c_x <= c_z) ? a : b;
  int c_5 = (c_x < c_y) ? a : b;
  int c_6 = (c_x != c_z) ? a : b;
  int c_7 = (c_x > c_z) ? 999 : b;
  int c_8 = (c_x >= c_z) ? 999 : 9;
  int c_9 = (9 <= 999) ? 999 : 9;

  int u_0 = (u_x > u_y) ? a : b;
  int u_1 = (u_x == c_x) ? a : b;
  int u_2 = (u_x != u_y) ? u_x : b;
  int u_3 = (c_x < c_z) ? u_x : b;
  int u_4 = (c_x < c_z) ? u_x : 999;
  int u_5 = (u_x < c_z) ? 99 : 999;

  float f0 = 0.5f;
  float f1 = 1.5f;
  double d0 = -0.5;
  double d1 = 1.7;
  float f2 = (f1 > f0) ? f1 : f0;
  f3 = (f1 < _f) ? _f : f1;
  d2 = (d1 > d0) ? d1 : d0;
  d3 = (d1 != _d) ? d1 : _d;
}

// VALNO: scope-1 {
// VALNO:   New VN #0: 'const_1'
// VALNO:   Alias "::@__choreo_no_tiling__" -> #0
// VALNO:   New VN #1: '::__choreo_no_tiling__'
// VALNO:   New VN #2: '::qes_op::u_x'
// VALNO:   New VN #3: '::qes_op::u_y'
// VALNO:   New VN #4: '::qes_op::_f'
// VALNO:   New VN #5: '::qes_op::_d'
// VALNO:   New VN #6: 'false'
// VALNO:   Alias "::qes_op::f" -> #6
// VALNO:   New VN #7: 'true'
// VALNO:   Alias "::qes_op::t" -> #7
// VALNO:   New VN #8: 'const_10'
// VALNO:   Alias "::qes_op::c_x" -> #8
// VALNO:   Alias "::qes_op::c_y" -> #8
// VALNO:   New VN #9: 'const_200'
// VALNO:   Alias "::qes_op::c_z" -> #9
// VALNO:   New VN #10: 'const_0'
// VALNO:   Alias "::qes_op::a" -> #10
// VALNO:   Alias "::qes_op::b" -> #0
// VALNO:   Alias "::qes_op::c_0" -> #0
// VALNO:   Alias "::qes_op::c_1" -> #10
// VALNO:   Alias "::qes_op::c_2" -> #10
// VALNO:   Alias "::qes_op::c_3" -> #10
// VALNO:   Alias "::qes_op::c_4" -> #10
// VALNO:   Alias "::qes_op::c_5" -> #0
// VALNO:   Alias "::qes_op::c_6" -> #10
// VALNO:   New VN #11: 'const_999'
// VALNO:   Alias "::qes_op::c_7" -> #0
// VALNO:   New VN #12: 'const_9'
// VALNO:   Alias "::qes_op::c_8" -> #12
// VALNO:   Alias "::qes_op::c_9" -> #11
// VALNO:   New VN #13: '>:#2:#3'
// VALNO:   New VN #14: '?:#13:#10:#0'
// VALNO:   Alias "::qes_op::u_0" -> #14
// VALNO:   New VN #15: '==:#2:#8'
// VALNO:   New VN #16: '?:#15:#10:#0'
// VALNO:   Alias "::qes_op::u_1" -> #16
// VALNO:   New VN #17: '!=:#2:#3'
// VALNO:   New VN #18: '?:#17:#2:#0'
// VALNO:   Alias "::qes_op::u_2" -> #18
// VALNO:   Alias "::qes_op::u_3" -> #2
// VALNO:   Alias "::qes_op::u_4" -> #2
// VALNO:   New VN #19: '<:#2:#9'
// VALNO:   New VN #20: 'const_99'
// VALNO:   New VN #21: '?:#19:#20:#11'
// VALNO:   Alias "::qes_op::u_5" -> #21
// VALNO:   New VN #22: 'const_0.500000f'
// VALNO:   New VN #24: 'const_1.500000f'
// VALNO:   New VN #26: 'const_-0.500000'
// VALNO:   New VN #28: 'const_1.700000'
// VALNO:  } // end scope-1

// CHECK: Parameter: ::qes_op::u_x, Type: s32
// CHECK: Parameter: ::qes_op::u_y, Type: s32
// CHECK: Parameter: ::qes_op::_f, Type: mutable f32
// CHECK: Parameter: ::qes_op::_d, Type: mutable f64
// CHECK: Symbol:    ::qes_op::f, Type: bool
// CHECK: Symbol:    ::qes_op::t, Type: bool
// CHECK: Symbol:    ::qes_op::c_x, Type: s32
// CHECK: Symbol:    ::qes_op::c_y, Type: s32
// CHECK: Symbol:    ::qes_op::c_z, Type: s32
// CHECK: Symbol:    ::qes_op::a, Type: s32
// CHECK: Symbol:    ::qes_op::b, Type: s32
// CHECK: Symbol:    ::qes_op::c_0, Type: s32
// CHECK: Symbol:    ::qes_op::c_1, Type: s32
// CHECK: Symbol:    ::qes_op::c_2, Type: s32
// CHECK: Symbol:    ::qes_op::c_3, Type: s32
// CHECK: Symbol:    ::qes_op::c_4, Type: s32
// CHECK: Symbol:    ::qes_op::c_5, Type: s32
// CHECK: Symbol:    ::qes_op::c_6, Type: s32
// CHECK: Symbol:    ::qes_op::c_7, Type: s32
// CHECK: Symbol:    ::qes_op::c_8, Type: s32
// CHECK: Symbol:    ::qes_op::c_9, Type: s32
// CHECK: Symbol:    ::qes_op::u_0, Type: s32
// CHECK: Symbol:    ::qes_op::u_1, Type: s32
// CHECK: Symbol:    ::qes_op::u_2, Type: s32
// CHECK: Symbol:    ::qes_op::u_3, Type: s32
// CHECK: Symbol:    ::qes_op::u_4, Type: s32
// CHECK: Symbol:    ::qes_op::u_5, Type: s32
// CHECK: Symbol:    ::qes_op::f0, Type: mutable f32
// CHECK: Symbol:    ::qes_op::f1, Type: mutable f32
// CHECK: Symbol:    ::qes_op::d0, Type: mutable f64
// CHECK: Symbol:    ::qes_op::d1, Type: mutable f64
// CHECK: Symbol:    ::qes_op::f2, Type: mutable f32
// CHECK: Symbol:    ::qes_op::f3, Type: mutable f32
// CHECK: Symbol:    ::qes_op::d2, Type: mutable f64
// CHECK: Symbol:    ::qes_op::d3, Type: mutable f64
// CHECK: Function:  ::qes_op, Type: void (*)(s32, s32, mutable f32, mutable f64)
