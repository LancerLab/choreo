// RUN: choreo %s -vn --stop-after=valno 2>&1 | FileCheck %s

__co__ auto placeholder(f32 [24, 17, 128] a) {
   f = dma.any;
   parallel p by 8 {
     with index = {x, y} in [17, 4] {
       f1 = dma.any;
       f3 = dma.any;
       f4 = dma.copy.async a.chunkat(p, x, y) => local;
       foreach x, y(1: -1) {
          f5 = select(2 - 1, f4, f1);
          f = dma.copy.async a.chunkat(p, x, y) => local;
          swap(f4, f);
          swap(f5, f1);
       }
       swap(f4, f3);  // ok.
       local f32 [f1.span] data;
       call kernel(|f.span|, |f1.span|, |f3.span|, |f4.span|, data);
     }
   }
   return f.data;
}

// CHECK:    Alias "::placeholder::a.span" -> #{{[0-9]+}}
// CHECK:    Alias "::placeholder::f.span" -> #<invalid>
// CHECK:      Alias "::placeholder{{(::paraby_[0-9]+)*}}::within_0::f1.span" -> #<invalid>
// CHECK:      Alias "::placeholder{{(::paraby_[0-9]+)*}}::within_0::f3.span" -> #<invalid>
// CHECK:      Alias "::placeholder{{(::paraby_[0-9]+)*}}::within_0::f4.span" -> [[VALNO:#[0-9]+]]
// CHECK:       Alias(Rebind) "::placeholder{{(::paraby_[0-9]+)*}}::within_0::f1.span" -> [[VALNO]]
// CHECK:       Alias "::placeholder{{(::paraby_[0-9]+)*}}::within_0::foreach_0::f5.span" -> [[VALNO]]
// CHECK:       Alias(Rebind) "::placeholder::f.span" -> [[VALNO]]
// CHECK:    Alias(Rebind) "::placeholder{{(::paraby_[0-9]+)*}}::within_0::f3.span" -> [[VALNO]]
// CHECK:      Alias "::placeholder{{(::paraby_[0-9]+)*}}::within_0::data.span" -> [[VALNO]]
