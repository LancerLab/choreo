// RUN: choreo -i %s | FileCheck --match-full-lines %s

__co__ void foo(s32[128, 256] input, u8[2, N] dinput) {
  s32[input.span] input1[2];
  u8[input.span] input2[3][2];
  u8[1, N] input3[1];

  parallel by 1 {
    shared u8[1, 256] u8_s0[2];
    foreach i in [128]
      dma.copy input2[1][1].chunkat(i, _) => u8_s0[1];
    l0 = dma.copy u8_s0[0] => local;
    foreach i in [2]
      dma.copy dinput.chunkat(i, _) => input3[0];
  }

}

// CHECK: Symbol:    ::foo::input1, Type: global s32 mdspan<2> {{\[128, 256\]\[\[2\]\]}}
// CHECK: Symbol:    ::foo::input2, Type: global u8 mdspan<2> {{\[128, 256\]\[\[3\]\[2\]\]}}
// CHECK: Symbol:    ::foo::input3, Type: global u8 mdspan<2> {{\[1, ::foo::N\]\[\[1\]\]}}
// CHECK: Symbol:    ::foo{{(::paraby_[0-9]+)*}}::u8_s0, Type: shared u8 mdspan<2> {{\[1, 256\]\[\[2\]\]}}
// CHECK: Future:    ::foo{{(::paraby_[0-9]+)*}}::within_0::foreach_0::(anon), Type: sync=>shared u8 mdspan<2> {{\[1, 256\]}}
// CHECK: Future:    ::foo{{(::paraby_[0-9]+)*}}::l0, Type: sync=>local u8 mdspan<2> {{\[1, 256\]}}
// CHECK: Future:    ::foo{{(::paraby_[0-9]+)*}}::within_1::foreach_1::(anon), Type: sync=>global u8 mdspan<2> {{\[1, ::foo::N\]}}
