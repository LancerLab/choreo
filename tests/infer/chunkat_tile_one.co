// RUN: choreo -i %s | FileCheck --check-prefix=INFER --match-full-lines %s

__co__ auto chunkat_dontcare(s32 [4, 8, 16] i) {
  s32 [i.span] o;
  parallel p by 4 {
    l0 = dma.copy i => local;
    // l1 = dma.copy i.chunkat(_, _, _) => local;
    with {t0} in [2] {
      foreach t0 {
        l2 = dma.copy i.chunkat(t0, _, _) => local;
        l3 = dma.copy i.chunkat(_, t0, _) => local;
        l4 = dma.copy i.chunkat(_, t0, t0) => local;
        l5 = dma.copy i.chunkat(_, t0, _) => local;
        dma.copy l5 => o.chunkat(_, t0, _);
      }
    }
  }
}

// INFER: Parameter: ::chunkat_dontcare::i, Type: s32 mdspan<3> [4, 8, 16]
// INFER: Symbol:    ::chunkat_dontcare::o, Type: global s32 mdspan<3> [4, 8, 16]
// INFER: Bounded:   ::chunkat_dontcare{{(::paraby_[0-9]+)*}}::p, Type: {int}->[4]
// INFER: Future:    ::chunkat_dontcare{{(::paraby_[0-9]+)*}}::l0, Type: sync=>local s32 mdspan<3> [4, 8, 16]
// INFER: Bounded:   ::chunkat_dontcare{{(::paraby_[0-9]+)*}}::within_0::t0, Type: {int}->[2]
// INFER: Future:    ::chunkat_dontcare{{(::paraby_[0-9]+)*}}::within_0::foreach_0::l2, Type: sync=>local s32 mdspan<3> [2, 8, 16]
// INFER: Future:    ::chunkat_dontcare{{(::paraby_[0-9]+)*}}::within_0::foreach_0::l3, Type: sync=>local s32 mdspan<3> [4, 4, 16]
// INFER: Future:    ::chunkat_dontcare{{(::paraby_[0-9]+)*}}::within_0::foreach_0::l4, Type: sync=>local s32 mdspan<3> [4, 4, 8]
// INFER: Future:    ::chunkat_dontcare{{(::paraby_[0-9]+)*}}::within_0::foreach_0::l5, Type: sync=>local s32 mdspan<3> [4, 4, 16]
// INFER: Future:    ::chunkat_dontcare{{(::paraby_[0-9]+)*}}::within_0::foreach_0::(anon), Type: sync=>global s32 mdspan<3> [4, 4, 16]
// INFER: Function:  ::chunkat_dontcare, Type: void (*)(s32 mdspan<3> [4, 8, 16])
