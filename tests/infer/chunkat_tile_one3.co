// RUN: choreo -i %s | FileCheck --check-prefix=INFER --match-full-lines %s

#define M 128
__co__ auto chunkat_tile_one3(f32 [M, 1] input) {
  f32 [input.span] out;
  block_span : input.span / {2, 1};
  parallel p by 2 {
    shared f32 [input.span] a;
    dma.copy input => a;
    local f32 [block_span] lin, res;
    dma.copy a.chunkat(p,_) => lin;
    call kernel(lin, res, |res|);
    dma.copy res => out.chunkat(p, _);
  }
  return out;
}


// INFER: Parameter: ::chunkat_tile_one3::input, Type: f32 mdspan<2> [128, 1]
// INFER: Symbol:    ::chunkat_tile_one3::out, Type: global f32 mdspan<2> [128, 1]
// INFER: Partial:   ::chunkat_tile_one3::block_span, Type: mdspan<2> [64, 1]
// INFER: Bounded:   ::chunkat_tile_one3{{(::paraby_[0-9]+)*}}::p, Type: {int}->[2]
// INFER: Symbol:    ::chunkat_tile_one3{{(::paraby_[0-9]+)*}}::a, Type: shared f32 mdspan<2> [128, 1]
// INFER: Future:    ::chunkat_tile_one3{{(::paraby_[0-9]+)*}}::(anon), Type: sync=>shared f32 mdspan<2> [128, 1]
// INFER: Symbol:    ::chunkat_tile_one3{{(::paraby_[0-9]+)*}}::lin, Type: local f32 mdspan<2> [64, 1]
// INFER: Symbol:    ::chunkat_tile_one3{{(::paraby_[0-9]+)*}}::res, Type: local f32 mdspan<2> [64, 1]
// INFER: Future:    ::chunkat_tile_one3{{(::paraby_[0-9]+)*}}::(anon), Type: sync=>local f32 mdspan<2> [64, 1]
// INFER: Future:    ::chunkat_tile_one3{{(::paraby_[0-9]+)*}}::(anon), Type: sync=>global f32 mdspan<2> [64, 1]
// INFER: Function:  ::chunkat_tile_one3, Type: f32 mdspan<2> [128, 1] (*)(f32 mdspan<2> [128, 1])
