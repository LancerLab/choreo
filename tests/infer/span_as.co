// RUN: choreo -i %s | FileCheck --check-prefix=CHKINF --match-full-lines %s

__co__ auto span_as(s32 [32, 18, 9] a) {
  f32 [a.span] b;
  s32 [48, 36] output0;
  s32 [48, 36] output1;
  parallel p by 3 {
   with index = {x, y} in [4, 4] {
     foreach index {
       // f.data: [4, 3, 9]
       f = dma.copy a.span_as([16, 9, 36]).chunkat(x, p, y) => local;
       g = dma.copy b.span_as([144, 36]).chunkat(p, p) => local;
       dma.copy f.data.span_as([12, 9]) => output0.chunkat(x, y);
       dma.copy f.span_as([12, 9]) => output1.chunkat(x, y);
     }
   }
  }
}

// CHKINF: Parameter: ::span_as::a, Type: s32 mdspan<3> [32, 18, 9]
// CHKINF: Symbol:    ::span_as::b, Type: global f32 mdspan<3> [32, 18, 9]
// CHKINF: Symbol:    ::span_as::output0, Type: global s32 mdspan<2> [48, 36]
// CHKINF: Symbol:    ::span_as::output1, Type: global s32 mdspan<2> [48, 36]
// CHKINF: Bounded:   ::span_as{{(::paraby_[0-9]+)*}}::p, Type: {int}->[3]
// CHKINF: Bounded:   ::span_as{{(::paraby_[0-9]+)*}}::within_0::index, Type: {int,int}->[4, 4]
// CHKINF: Bounded:   ::span_as{{(::paraby_[0-9]+)*}}::within_0::x, Type: {int}->[4]
// CHKINF: Bounded:   ::span_as{{(::paraby_[0-9]+)*}}::within_0::y, Type: {int}->[4]
// CHKINF: Future:    ::span_as{{(::paraby_[0-9]+)*}}::within_0::foreach_0::f, Type: sync=>local s32 mdspan<3> [4, 3, 9]
// CHKINF: Future:    ::span_as{{(::paraby_[0-9]+)*}}::within_0::foreach_0::g, Type: sync=>local f32 mdspan<2> [48, 12]
// CHKINF: Future:    ::span_as{{(::paraby_[0-9]+)*}}::within_0::foreach_0::(anon), Type: sync=>global s32 mdspan<2> [12, 9]
// CHKINF: Future:    ::span_as{{(::paraby_[0-9]+)*}}::within_0::foreach_0::(anon), Type: sync=>global s32 mdspan<2> [12, 9]
// CHKINF: Function:  ::span_as, Type: void (*)(s32 mdspan<3> [32, 18, 9])
