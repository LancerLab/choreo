// RUN: choreo -i %s | FileCheck --match-full-lines %s

__co__ void concat(s32 [20, 7] a, s32 mdspan<1> b) {
  c : [a.span, [3, 2]];            // mdspan, mdsapn
  with index in [c, b.span] {}     // mdspan, mdspan
  d : [c, 1, c(3)];                // mdspan, int, int
  e : [d];                         // mdspan
}

// CHECK:Parameter: ::concat::a, Type: s32 mdspan<2> [20, 7]
// CHECK:Parameter: ::concat::b, Type: s32 mdspan<1> [::concat::$0]
// CHECK:Partial:   ::concat::c, Type: mdspan<4> [20, 7, 3, 2]
// CHECK:Bounded:   ::concat::within_0::index, Type: {int,int,int,int,int}->[20, 7, 3, 2, ::concat::$0]
// CHECK:Partial:   ::concat::e, Type: mdspan<6> [20, 7, 3, 2, 1, 2]
// CHECK:Function:  ::concat, Type: void (*)(s32 mdspan<2> [20, 7], s32 mdspan<1> [::concat::$0])

__co__ void concat2(s32 [21, 14] a) {
  c : [3, 2];
  with index in [a.span / c, 3] {}  // ituple, int
  d = c / [1, 1];
  f32 [d] data;                     // ituple only
  e : [ a.span, d ];                // mdspan, ituple
  f : [ a.span / c, d ];            // ituple, ituple
}

// CHECK:Parameter: ::concat2::a, Type: s32 mdspan<2> [21, 14]
// CHECK:Partial:   ::concat2::c, Type: mdspan<2> [3, 2]
// CHECK:Bounded:   ::concat2::within_1::index, Type: {int,int,int}->[7, 7, 3]
// CHECK:Symbol:    ::concat2::d, Type: ituple<2>
// CHECK:Symbol:    ::concat2::data, Type: global f32 mdspan<2> [3, 2]
// CHECK:Partial:   ::concat2::e, Type: mdspan<4> [21, 14, 3, 2]
// CHECK:Partial:   ::concat2::f, Type: mdspan<4> [7, 7, 3, 2]
// CHECK:Function:  ::concat2, Type: void (*)(s32 mdspan<2> [21, 14])

