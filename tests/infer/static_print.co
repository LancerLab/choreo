// RUN: choreo %s -sa=infer | FileCheck %s

__co__ void foo(s32 [N, M] i) {
  println("aaa");
  int a = 100;
  bool b = false;
  float f = 1.3f;
  double d = 2.6;
  double dd = 3.9;
  print!("scalar:\n\ta: ", a, "\n\tM: ", M, "\n\tf: ", f, "\n\td: ", d, "\n\tb: ", b, "\n");
  println!("\td+dd: ", d+dd);
  parallel p by 1 {
    mds : [1,2,3];
    it = {4, M};
    nit = {a, 5};
    println!("a + 100: ", a + 100);
    println!("M + 10: ", M + 100);
    println!("i.span: ", i.span);
    println!("mds: ", mds);
    println!("it: ", it);
    println!("nit: ", nit + 1);
    foreach idx in [1,2,1] {
      println!("idx: ", idx);
      foreach bi in 4
        println!("bi: ", bi+N);
    }
  }
  print!("bbb\n");
}

// CHECK: scalar:
// CHECK:         a: 100
// CHECK:         M: ::foo::M
// CHECK:         f: unknown
// CHECK:         d: unknown
// CHECK:         b: false
// CHECK:         d+dd: unknown
// CHECK: a + 100: 200
// CHECK: M + 10: (::foo::M + 100)
// CHECK: i.span: [::foo::N, ::foo::M]
// CHECK: mds: [1, 2, 3]
// CHECK: it: {4, ::foo::M}
// CHECK: nit: {101, 6}
// CHECK: idx: rt-val
// CHECK: bi: rt-val
// CHECK: bbb
