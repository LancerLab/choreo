// RUN: choreo -i %s | FileCheck --match-full-lines %s
// RUN: choreo -vn %s | FileCheck --check-prefix=VALNO --match-full-lines %s

__co__ void foo(f32 mdspan[2, 3, 4] d, int e, bool, f32 mdspan<2> a) { }

// VALNO:  scope-1 {
// VALNO:   New VN #0: 'const_1'
// VALNO:   Alias "::@__choreo_no_tiling__" -> #0
// VALNO:   New VN #1: 'const_0'
// VALNO:   Alias "::__choreo_no_tiling__" -> #1
// VALNO:   New VN #2: '::__choreo_parent_dim__'
// VALNO:   New VN #3: 'const_2'
// VALNO:   New VN #4: 'const_3'
// VALNO:   New VN #5: 'const_4'
// VALNO:   New VN #6: '#3,#4,#5'
// VALNO:   Alias "::foo::d.span" -> #6
// VALNO:   New VN #7: '::foo::e'
// VALNO:   New VN #8: '::foo::anon_0'
// VALNO:   New VN #9: '::foo::$0'
// VALNO:   New VN #10: '::foo::$1'
// VALNO:   New VN #11: '#9,#10'
// VALNO:   Alias "::foo::a.span" -> #11
// VALNO:  } // end scope-1

// CHECK: Parameter: ::foo::d, Type: f32 mdspan<3> [2, 3, 4]
// CHECK: Parameter: ::foo::e, Type: s32
// CHECK: Parameter: ::foo::anon_0, Type: bool
// CHECK: Parameter: ::foo::a, Type: f32 mdspan<2> [::foo::$0, ::foo::$1]
// CHECK: Function:  ::foo, Type: void (*)(f32 mdspan<3> [2, 3, 4], s32, bool, f32 mdspan<2> [::foo::$0, ::foo::$1])

__co__ void bar(f32 mdspan[?, 2, ?, 4] d, f32 mdspan<4> a) { }

// VALNO:  scope-1 {
// VALNO:   New VN #12: '::bar::$0'
// VALNO:   New VN #13: '::bar::$1'
// VALNO:   New VN #14: '#12,#3,#13,#5'
// VALNO:   Alias "::bar::d.span" -> #14
// VALNO:   New VN #15: '::bar::$2'
// VALNO:   New VN #16: '::bar::$3'
// VALNO:   New VN #17: '::bar::$4'
// VALNO:   New VN #18: '::bar::$5'
// VALNO:   New VN #19: '#15,#16,#17,#18'
// VALNO:   Alias "::bar::a.span" -> #19
// VALNO:  } // end scope-1

// CHECK: Parameter: ::bar::d, Type: f32 mdspan<4> [::bar::$0, 2, ::bar::$1, 4]
// CHECK: Parameter: ::bar::a, Type: f32 mdspan<4> [::bar::$2, ::bar::$3, ::bar::$4, ::bar::$5]
// CHECK: Function:  ::bar, Type: void (*)(f32 mdspan<4> [::bar::$0, 2, ::bar::$1, 4], f32 mdspan<4> [::bar::$2, ::bar::$3, ::bar::$4, ::bar::$5])

__co__ auto foobar(f32 mdspan[?, 2, ?, 4] a) { return a; }

// VALNO:  scope-1 {
// VALNO:   New VN #20: '::foobar::$0'
// VALNO:   New VN #21: '::foobar::$1'
// VALNO:   New VN #22: '#20,#3,#21,#5'
// VALNO:   Alias "::foobar::a.span" -> #22
// VALNO:  } // end scope-1

// CHECK: Parameter: ::foobar::a, Type: f32 mdspan<4> [::foobar::$0, 2, ::foobar::$1, 4]
// CHECK: Function:  ::foobar, Type: f32 mdspan<4> [::foobar::$0, 2, ::foobar::$1, 4] (*)(f32 mdspan<4> [::foobar::$0, 2, ::foobar::$1, 4])
