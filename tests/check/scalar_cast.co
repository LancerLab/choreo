// RUN: choreo %s -dv=norm -sa=norm | FileCheck %s 
// RUN: choreo %s -es 2>&1 | FileCheck %s --check-prefix=CODEGEN


__co__ auto ele_add(int i, float f, double d) {
  mutable float ff = i;
  mutable int dd = d;

  mutable int a = 1.5;
  mutable int b = 10.5f;

  mutable int x = 1.5f + 13;
  mutable double y = i + 1.3f;
  
  mutable int z = i + 1.3f;
  mutable int p = (x > z) ? y : z;

  return x + z + p;
}

// CHECK: Cast 'i' at {{.*}}
// CHECK:         's32' => 'f32'
// CHECK: Cast 'd' at {{.*}}
// CHECK:         'f64' => 's32'
// CHECK: Cast '1.500000' at {{.*}}
// CHECK:         'f64' => 's32'
// CHECK: Cast '10.500000f' at {{.*}}
// CHECK:         'f32' => 's32'
// CHECK: Promote '13' at {{.*}}
// CHECK:         's32' => 'f32'
// CHECK: Cast ' (1.500000f + CAST(s32=>f32: '13') ) ' at {{.*}}
// CHECK:         'f32' => 's32'
// CHECK: Promote 'i' at {{.*}}
// CHECK:         's32' => 'f32'
// CHECK: Cast ' (CAST(s32=>f32: 'i')  + 1.300000f) ' at {{.*}}
// CHECK:         'f32' => 'f64'
// CHECK: Promote 'i' at {{.*}}
// CHECK:         's32' => 'f32'
// CHECK: Cast ' (CAST(s32=>f32: 'i')  + 1.300000f) ' at {{.*}}
// CHECK:         'f32' => 's32'
// CHECK: Promote 'z' at {{.*}}
// CHECK:         's32' => 'f64'
// CHECK: Cast ' ( (x > z)  ? y : CAST(s32=>f64: 'z') ) ' at {{.*}}
// CHECK:         'f64' => 's32'

// CODEGEN: warning: The implicit type conversion may lose precision: 's32' to 'f32'
// CODEGEN:    mutable float ff = i;
// CODEGEN:                       ^
// CODEGEN: warning: The implicit type conversion may lose precision: 'f64' to 's32'
// CODEGEN:    mutable int dd = d;
// CODEGEN:                     ^
// CODEGEN: warning: The implicit type conversion may lose precision: 'f64' to 's32'
// CODEGEN:    mutable int a = 1.5;
// CODEGEN:                    ^
// CODEGEN: warning: The implicit type conversion may lose precision: 'f32' to 's32'
// CODEGEN:    mutable int b = 10.5f;
// CODEGEN:                    ^
// CODEGEN: warning: The implicit type conversion may lose precision: 's32' to 'f32'
// CODEGEN:    mutable int x = 1.5f + 13;
// CODEGEN:                           ^
// CODEGEN: warning: The implicit type conversion may lose precision: 'f32' to 's32'
// CODEGEN:    mutable int x = 1.5f + 13;
// CODEGEN:                    ^
// CODEGEN: warning: The implicit type conversion may lose precision: 's32' to 'f32'
// CODEGEN:    mutable double y = i + 1.3f;
// CODEGEN:                       ^
// CODEGEN: warning: The implicit type conversion may lose precision: 's32' to 'f32'
// CODEGEN:    mutable double y = i + 1.3f;
// CODEGEN:                       ^
// CODEGEN: warning: The implicit type conversion may lose precision: 's32' to 'f32'
// CODEGEN:    mutable int z = i + 1.3f;
// CODEGEN:                    ^
// CODEGEN: warning: The implicit type conversion may lose precision: 'f32' to 's32'
// CODEGEN:    mutable int z = i + 1.3f;
// CODEGEN:                    ^
// CODEGEN: warning: The implicit type conversion may lose precision: 'f64' to 's32'
// CODEGEN:    mutable int p = (x > z) ? y : z;
// CODEGEN:                    ^

// CODEGEN: int ele_add(int i, float f, double d) {
// CODEGEN:   float ff = static_cast<float>(i);
// CODEGEN:   int dd = static_cast<int>(d);
// CODEGEN:   int a = static_cast<int>(1.500000);
// CODEGEN:   int b = static_cast<int>(10.500000f);
// CODEGEN:   int x = static_cast<int>(1.500000f + static_cast<float>(13));
// CODEGEN:   double y = static_cast<double>(static_cast<float>(i) + 1.300000f);
// CODEGEN:   int z = static_cast<int>(static_cast<float>(i) + 1.300000f);
// CODEGEN:   int p = static_cast<int>((x > z) ? y : static_cast<double>(z));
// CODEGEN:   return (p + (x + z));
// CODEGEN: }
