// RUN: not choreo %s 2>&1 | FileCheck %s

__co__ auto illegal_ret0(f32 [36, 27, 128] input, f32 [18, 9, 128]) {
  parallel p by 6 {
    return input;
    with index in [3, 9] {
      foreach index {
        f = dma.copy input.chunkat(p, index) => local;
      }
    }
  }
}
// CHECK: unable to return inside the parallel-by block(s)

__co__ auto illegal_ret1(f32 [36, 27, 128] input) {
  parallel p by 6 {
    parallel q by 2 {
      return input;
      with index in [3] {
        foreach index {
          f = dma.copy input.chunkat(p, index, q) => local;
        }
      }
    }
  }
}
// CHECK: unable to return inside the parallel-by block(s)

__co__ auto illegal_ret2(f32 [36, 27, 128] input) {
  parallel p by 6 {
    with index in [3, 9] {
      return 1;
      foreach index {
        f = dma.copy input.chunkat(p, index) => local;
      }
    }
  }
}
// CHECK: unable to return inside the parallel-by block(s)

__co__ auto illegal_ret3(f32 [36, 27, 128] input) {
  parallel p by 6 {
    with index in [3, 9] {
      foreach index {
        f = dma.copy.async input.chunkat(p, index) => local;
        wait f;
        return f.data;
      }
    }
  }
}
// CHECK: unable to return inside the parallel-by block(s)
// CHECK: Totally 4 errors have been detected
