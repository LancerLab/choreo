// REQUIRES: TARGET-GPU
// RUN: choreo -gs -t cute -use-cuda-type=false %s -o %s.cute.result && bash %s.cute.result --execute | FileCheck --match-full-lines %s && rm -f %s.cute.result

__co__ auto copy_f6_e3m2(f6_e3m2 [6, 64] lhs) {
  f6_e3m2[lhs.span] output;
  parallel p by 6, q by 64
    output.at(p, q) = lhs.at(p, q);
  return output;
}

__co__ auto copy_f6_e2m3(f6_e2m3 [6, 64] lhs) {
  f6_e2m3[lhs.span] output;
  parallel p by 6, q by 64
    output.at(p, q) = lhs.at(p, q);
  return output;
}

__co__ auto copy_f4_e2m1(f4_e2m1 [6, 64] lhs) {
  f4_e2m1[lhs.span] output;
  parallel p by 6, q by 64
    output.at(p, q) = lhs.at(p, q);
  return output;
}

#define TEST_CUTE_TYPE2(type) \
  using t_##type = choreo::type; \
  auto a_##type = choreo::make_spandata<t_##type>(6, 64); \
  a_##type.fill_random(-10.0f, 10.0f); \
  auto res_##type = copy_##type(a_##type.view()); \
  for (size_t i = 0; i < res_##type.shape()[0]; ++i) \
    for (size_t j = 0; j < res_##type.shape()[1]; ++j) { \
      auto ref = float(a_##type[i][j]); \
      if (float(res_##type[i][j]) != ref) \
        choreo::choreo_assert(false, "values are not equal."); \
    } \
  std::cout << "Test " << #type << " Passed\n" << std::endl;

int main() { /// host program
  TEST_CUTE_TYPE2(f6_e3m2);
  TEST_CUTE_TYPE2(f6_e2m3);
  TEST_CUTE_TYPE2(f4_e2m1);
  std::cout << "Test Passed\n" << std::endl;
}
// CHECK: Test f6_e3m2 Passed
// CHECK: Test f6_e2m3 Passed
// CHECK: Test f4_e2m1 Passed
// CHECK: Test Passed
