// RUN: choreo -e %s |FileCheck %s

__co__ void foo() {
  parallel p by 6 {
    with index in [3, 2, 1] 
      foreach index if (p < 3) {}
  }
}

__co__ void bar(int N) {
  parallel p by 6 {
    with index = {x, y, z} in [3, 2, 1] 
      foreach index if (p < N % #p) {}
  }
}

__co__ void foobar(int N, int M) {
  with index = {x, y, z} in [M, 2, 1] 
    foreach index if ((x < N % M) && (y < N)) {}
}

// CHECK: ChoreoFunction
// CHECK:  `- Name: foo
// CHECK:  `- Return type: void
// CHECK:  `- Parameters:
// CHECK:  `- Parallelization:  index symbol: p, bound [0, 6)
// CHECK:   `- With Block:
// CHECK:     (within constraints)
// CHECK:     `- index in [ 3 2 1 ]
// CHECK:     (with statements)
// CHECK:     `- Foreach Block:
// CHECK:      `- Iteration variables: index
// CHECK:      `- Branch On Condition:  (p < 3)

// CHECK: ChoreoFunction
// CHECK:  `- Name: bar
// CHECK:  `- Return type: void
// CHECK:  `- Parameters:
// CHECK:    `-  type: s32, symbol: N
// CHECK:  `- Parallelization:  index symbol: p, bound [0, 6)
// CHECK:   `- With Block:
// CHECK:     (within constraints)
// CHECK:     `- index = {x, y, z} in [ 3 2 1 ]
// CHECK:     (with statements)
// CHECK:     `- Foreach Block:
// CHECK:      `- Iteration variables: index
// CHECK:      `- Branch On Condition:  (p <  (N %  (ubound p) ) )

// CHECK: ChoreoFunction
// CHECK:  `- Name: foobar
// CHECK:  `- Return type: void
// CHECK:  `- Parameters:
// CHECK:    `-  type: s32, symbol: N
// CHECK:    `-  type: s32, symbol: M
// CHECK:  `- With Block:
// CHECK:    (within constraints)
// CHECK:    `- index = {x, y, z} in [ M 2 1 ]
// CHECK:    (with statements)
// CHECK:    `- Foreach Block:
// CHECK:     `- Iteration variables: index
// CHECK:     `- Branch On Condition:  ( (x <  (N % M) )  &&  (y < N) )
