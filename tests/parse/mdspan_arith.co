// RUN: choreo -e %s | FileCheck --match-full-lines %s

__co__ bf16 mdspan<3> span_arith(s32 mdspan<4> d, int c) {
  mdspan dims : [9, c];  // shape, mdspan node
  dim1 : [3, 5, 7];
  ituple e = {7, 8, 9};
  sum : d.span + e;
  sub : d.span - {d.span(0), c} + e;
  mul : d.span * e;
  div : dims / {2, 3, 4};
  mod : d.span % {e (2), e (3)};
  new : d.span / {7, 8, 9} * {1, 2};
}

// CHECK: ChoreoFunction
// CHECK:  `- Name: span_arith
// CHECK:  `- Return type: bf16 <3>
// CHECK:  `- Parameters:
// CHECK:    `-  type: s32 <4>, symbol: d
// CHECK:    `-  type: s32, symbol: c
// CHECK:  `- Type Decl: dims - [ 9 c ]
// CHECK:  `- Type Decl: dim1 - [ 3 5 7 ]
// CHECK:  `- Var Decl (ituple): e = {7, 8, 9}
// CHECK:  `- Type Decl: sum -  (d.span + e)
// CHECK:  `- Type Decl: sub -  ( (d.span - {d.span(0), c})  + e)
// CHECK:  `- Type Decl: mul -  (d.span * e)
// CHECK:  `- Type Decl: div -  (dims / {2, 3, 4})
// CHECK:  `- Type Decl: mod -  (d.span % {e(2), e(3)})
// CHECK:  `- Type Decl: new -  ( (d.span / {7, 8, 9})  * {1, 2})

__co__ void span_arith1(s32 [32, 18, 6, 1] d, int c) {
  ituple<4> g = {c, 2, 4, 3};
  ituple a = d / [3, 4, 5, 6]; // mdspan / mdspan : ituple
  b = d % [3, 4, 5, 6];        // mdspan % mdspan : ituple
  f = a + 1;                   // ituple + integer : ituple
  e = 5 + d;                   // mdspan + integer : mdspan
}

// CHECK: ChoreoFunction
// CHECK:  `- Name: span_arith1
// CHECK:  `- Return type: void
// CHECK:  `- Parameters:
// CHECK:    `-  type: s32 [ 32 18 6 1 ], symbol: d
// CHECK:    `-  type: s32, symbol: c
// CHECK:  `- Var Decl (ituple): g = {c, 2, 4, 3}
// CHECK:  `- Var Decl (ituple): a =  (d / [ 3 4 5 6 ])
// CHECK:  `- Var Decl (unknown): b =  (d % [ 3 4 5 6 ])
// CHECK:  `- Var Decl (unknown): f =  (a + 1)
// CHECK:  `- Var Decl (unknown): e =  (5 + d)
