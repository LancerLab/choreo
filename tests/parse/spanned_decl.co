// RUN: choreo -e %s | FileCheck --match-full-lines %s
#include <iostream>

// device program
__co__ void spanned(f32 mdspan<3> d, int f) {
  dim1 : [100, 100];
  mdspan dim2 : [9, f];

  f32 [dim1] data0;
  u8 [10, 20, 30] data1;
  f16 [d.span] data2;
  s32 [dim2 / {1, 3}] data3;

  f32 [dim1] d0, d1, d2;
  u8 [10, 20, 30] d3, d4;
  f16 [d.span] d5, d6[3];
  s32 [dim2 / {1, 3}] d7, d8, d9, d10;
  
  parallel p by 4 {
    shared f32 [dim1] sd0, sd1[2], sd2;
    parallel q by 2 {
      local f32 [dim1] sd3, sd4, sd5;
    }
  }
}

// CHECK: ChoreoFunction
// CHECK:  `- Name: spanned
// CHECK:  `- Return type: void
// CHECK:  `- Parameters:
// CHECK:    `-  type: f32 <3>, symbol: d
// CHECK:    `-  type: s32, symbol: f
// CHECK:  `- Type Decl: dim1 - [ 100 100 ]
// CHECK:  `- Type Decl: dim2 - [ 9 f ]
// CHECK:  `- Var Decl (f32 [ dim1 ], default): data0
// CHECK:  `- Var Decl (u8 [ 10 20 30 ], default): data1
// CHECK:  `- Var Decl (f16 [ d.span ], default): data2
// CHECK:  `- Var Decl (s32 [ (dim2 / {1, 3}) ], default): data3
// CHECK:  `- Var Decl (f32 [ dim1 ], default): d0
// CHECK:  `- Var Decl (f32 [ dim1 ], default): d1
// CHECK:  `- Var Decl (f32 [ dim1 ], default): d2
// CHECK:  `- Var Decl (u8 [ 10 20 30 ], default): d3
// CHECK:  `- Var Decl (u8 [ 10 20 30 ], default): d4
// CHECK:  `- Var Decl (f16 [ d.span ], default): d5
// CHECK:  `- Var Decl (f16 [ d.span ], default): d6[3]
// CHECK:  `- Var Decl (s32 [ (dim2 / {1, 3})  ], default): d7
// CHECK:  `- Var Decl (s32 [ (dim2 / {1, 3})  ], default): d8
// CHECK:  `- Var Decl (s32 [ (dim2 / {1, 3})  ], default): d9
// CHECK:  `- Var Decl (s32 [ (dim2 / {1, 3})  ], default): d10
// CHECK:  `- Parallelization:  index symbol: p, bound [0, 4)
// CHECK:   `- Var Decl (f32 [ dim1 ], shared): sd0
// CHECK:   `- Var Decl (f32 [ dim1 ], shared): sd1[2]
// CHECK:   `- Var Decl (f32 [ dim1 ], shared): sd2
// CHECK:   `- Parallelization:  index symbol: q, bound [0, 2)
// CHECK:    `- Var Decl (f32 [ dim1 ], local): sd3
// CHECK:    `- Var Decl (f32 [ dim1 ], local): sd4
// CHECK:    `- Var Decl (f32 [ dim1 ], local): sd5
