// RUN: choreo -e %s | FileCheck %s

__co__ void if_else(int a) {
  mutable b = 0;
  if (a > 0) {
    b = a - 1;
  }

  if (a > 1) {
    b = a - 1;
  } else {
    b = a + 1;
  }

  if (a > 2) {
    b = a - 1;
    if (a > 3) {
      b = a - 1;
    }
  }

  if (a > 4) {
    b = a - 1;
    if (a > 5) {
      b = a - 1;
    } else {
      b = a + 1;
    }
  }

  if (a > 6) {
    b = a - 1;
    if (a > 7) {
      b = a - 1;
    }
  } else {
    b = a + 1;
  }
}

// CHECK: ChoreoFunction
// CHECK:  `- Name: if_else
// CHECK:  `- Return type: void
// CHECK:  `- Parameters:
// CHECK:    `-  type: s32, symbol: a
// CHECK:  `- Var Decl (mutable unknown): b =  0
// CHECK:  `- Branch On Condition:  (a > 0)
// CHECK:   `- If-Block:
// CHECK:    `- Assign: b =  (a - 1)
// CHECK:  `- Branch On Condition:  (a > 1)
// CHECK:   `- If-Block:
// CHECK:    `- Assign: b =  (a - 1)
// CHECK:   `- Else-Block:
// CHECK:    `- Assign: b =  (a + 1)
// CHECK:  `- Branch On Condition:  (a > 2)
// CHECK:   `- If-Block:
// CHECK:    `- Assign: b =  (a - 1)
// CHECK:    `- Branch On Condition:  (a > 3)
// CHECK:     `- If-Block:
// CHECK:      `- Assign: b =  (a - 1)
// CHECK:  `- Branch On Condition:  (a > 4)
// CHECK:   `- If-Block:
// CHECK:    `- Assign: b =  (a - 1)
// CHECK:    `- Branch On Condition:  (a > 5)
// CHECK:     `- If-Block:
// CHECK:      `- Assign: b =  (a - 1)
// CHECK:     `- Else-Block:
// CHECK:      `- Assign: b =  (a + 1)
// CHECK:  `- Branch On Condition:  (a > 6)
// CHECK:   `- If-Block:
// CHECK:    `- Assign: b =  (a - 1)
// CHECK:    `- Branch On Condition:  (a > 7)
// CHECK:     `- If-Block:
// CHECK:      `- Assign: b =  (a - 1)
// CHECK:   `- Else-Block:
// CHECK:    `- Assign: b =  (a + 1)


__co__ int dangling_else(int a, int b) {
  if (a > 3)
    if (b < 2)
      d = b + 1;
    else
      call foobar();

  if (b < a)
    if (b > 3)
      if (b < 4) call foobar();
      else call barfoo();
}

// CHECK: ChoreoFunction
// CHECK:  `- Name: dangling_else
// CHECK:  `- Return type: s32
// CHECK:  `- Parameters:
// CHECK:    `-  type: s32, symbol: a
// CHECK:    `-  type: s32, symbol: b
// CHECK:  `- Branch On Condition:  (a > 3)
// CHECK:   `- If-Block:
// CHECK:    `- Branch On Condition:  (b < 2)
// CHECK:     `- If-Block:
// CHECK:      `- Var Decl (unknown): d =  (b + 1)
// CHECK:     `- Else-Block:
// CHECK:      `- Call: foobar
// CHECK:  `- Branch On Condition:  (b < a)
// CHECK:   `- If-Block:
// CHECK:    `- Branch On Condition:  (b > 3)
// CHECK:     `- If-Block:
// CHECK:      `- Branch On Condition:  (b < 4)
// CHECK:       `- If-Block:
// CHECK:        `- Call: foobar
// CHECK:       `- Else-Block:
// CHECK:        `- Call: barfoo
