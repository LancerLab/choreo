// RUN: choreo -e %s |FileCheck %s

__co__ void foo(int N, int M, s32[2,4] lhs) {
  parallel p by 6 {
    foreach index in 6 if (p < 3) {}
    foreach index in [3, 2, 1] {}
    foreach {x,y,z} in [M, 2, 1] if (p < N % #p) {}
    foreach index in lhs.span if (p < N % #p) {}
  }
}

// CHECK: ChoreoFunction
// CHECK:  `- Name: foo
// CHECK:  `- Return type: void
// CHECK:  `- Parameters:
// CHECK:    `-  type: s32, symbol: N
// CHECK:    `-  type: s32, symbol: M
// CHECK:    `-  type: s32 [ 2 4 ], symbol: lhs
// CHECK:  `- Parallelization:  index symbol: p, bound [0, 6)
// CHECK:   `- With Block:
// CHECK:     (within constraints)
// CHECK:     `- index in 6
// CHECK:     (with statements)
// CHECK:     `- Foreach Block:
// CHECK:      `- Iteration variables: index
// CHECK:      `- Branch On Condition:  (p < 3) 
// CHECK:   `- With Block:
// CHECK:     (within constraints)
// CHECK:     `- index in [ 3 2 1 ]
// CHECK:     (with statements)
// CHECK:     `- Foreach Block:
// CHECK:      `- Iteration variables: index
// CHECK:   `- With Block:
// CHECK:     (within constraints)
// CHECK:     `- {x, y, z} in [ M 2 1 ]
// CHECK:     (with statements)
// CHECK:     `- Foreach Block:
// CHECK:      `- Iteration variables: x
// CHECK:      `- Iteration variables: y
// CHECK:      `- Iteration variables: z
// CHECK:      `- Branch On Condition:  (p <  (N %  (ubound p) ) ) 
// CHECK:   `- With Block:
// CHECK:     (within constraints)
// CHECK:     `- index in lhs.span
// CHECK:     (with statements)
// CHECK:     `- Foreach Block:
// CHECK:      `- Iteration variables: index
// CHECK:      `- Branch On Condition:  (p <  (N %  (ubound p) ) )
