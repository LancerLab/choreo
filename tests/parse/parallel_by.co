// RUN: choreo -e %s | FileCheck %s --match-full-lines


__co__ int simple_pb() {
  parallel by 12 { }
}

// CHECK: ChoreoFunction
// CHECK:  `- Name: simple_pb
// CHECK:  `- Return type: s32
// CHECK:  `- Parameters:
// CHECK:  `- Parallelization: index symbol: anon_0, bound [0, 12)

__co__ int parallel_by(int a, int b) {
  parallel p by 6 { }
}

// CHECK: ChoreoFunction
// CHECK:  `- Name: parallel_by
// CHECK:  `- Return type: s32
// CHECK:  `- Parameters:
// CHECK:    `-  type: s32, symbol: a
// CHECK:    `-  type: s32, symbol: b
// CHECK:  `- Parallelization: index symbol: p, bound [0, 6)

__co__ int parallel_by_nest(int a, int b) {
  parallel p by 6 {
    parallel q by 64 {}
  }
}

// CHECK: ChoreoFunction
// CHECK:  `- Name: parallel_by_nest
// CHECK:  `- Return type: s32
// CHECK:  `- Parameters:
// CHECK:    `-  type: s32, symbol: a
// CHECK:    `-  type: s32, symbol: b
// CHECK:  `- Parallelization: index symbol: p, bound [0, 6)
// CHECK:   `- Parallelization: index symbol: q, bound [0, 64)

__co__ int parallel_by0() {
  parallel {p} by [6] {
    int a = 100;
  }
}

// CHECK: ChoreoFunction
// CHECK:  `- Name: parallel_by0
// CHECK:  `- Return type: s32
// CHECK:  `- Parameters:
// CHECK:  `- Parallelization: index symbol: anon_1, bound [0, 6)
// CHECK:                      index component: {p}, corresponding ubound: [6]
// CHECK:   `- Var Decl (s32): a = 100

__co__ int parallel_by1() {
  parallel {p, q} by [128, 64] {
    int b = 100;
  }
}

// CHECK: ChoreoFunction
// CHECK:  `- Name: parallel_by1
// CHECK:  `- Return type: s32
// CHECK:  `- Parameters:
// CHECK:  `- Parallelization: index symbol: anon_2, bound [0,  (128 * 64) )
// CHECK:                      index component: {p, q}, corresponding ubound: [128, 64]
// CHECK:   `- Var Decl (s32): b = 100

__co__ int parallel_by2() {
  parallel {p, q, r} by [6, 32, 64] {}
}

// CHECK: ChoreoFunction
// CHECK:  `- Name: parallel_by2
// CHECK:  `- Return type: s32
// CHECK:  `- Parameters:
// CHECK:  `- Parallelization: index symbol: anon_3, bound [0,  ( (6 * 32)  * 64) )
// CHECK:                      index component: {p, q, r}, corresponding ubound: [6, 32, 64]

__co__ int parallel_by3() {
  parallel bdim = {x, y, z} by [2, 4, 8] {}
}

// CHECK: ChoreoFunction
// CHECK:  `- Name: parallel_by3
// CHECK:  `- Return type: s32
// CHECK:  `- Parameters:
// CHECK:  `- Parallelization: index symbol: bdim, bound [0,  ( (2 * 4)  * 8) )
// CHECK:                      index component: {x, y, z}, corresponding ubound: [2, 4, 8]

__co__ void bar2() {
  parallel g by 2, b by 12 {
    local f16[4] l;
  }

  parallel gdim = {xx, yy, zz} by [2, 6, 3],
           bdim = {x, y} by [4, 5] {
    local f16[4] l;
  }

  parallel g by 4,
           b = {x, y, z} by [4, 3, 2] {
    local f16[4] l;
  }
}


// CHECK: ChoreoFunction
// CHECK:  `- Name: bar2
// CHECK:  `- Return type: void
// CHECK:  `- Parameters:
// CHECK:  `- Parallelization: index symbol: g, bound [0, 2)
// CHECK:   `- Parallelization: index symbol: b, bound [0, 12)
// CHECK:    `- Var Decl (f16 [ 4 ], local): l
// CHECK:  `- Parallelization: index symbol: gdim, bound [0,  ( (2 * 6)  * 3) )
// CHECK:                      index component: {xx, yy, zz}, corresponding ubound: [2, 6, 3]
// CHECK:   `- Parallelization: index symbol: bdim, bound [0,  (4 * 5) )
// CHECK:                       index component: {x, y}, corresponding ubound: [4, 5]
// CHECK:    `- Var Decl (f16 [ 4 ], local): l
// CHECK:  `- Parallelization:  index symbol: g, bound [0, 4)
// CHECK:   `- Parallelization:  index symbol: b, bound [0,  ( (4 * 3)  * 2) )
// CHECK:                        index component: {x, y, z}, corresponding ubound: [4, 3, 2]
// CHECK:    `- Var Decl (f16 [ 4 ], local): l

__co__ void async_parallel_by() {
  parallel.async by 3 ;
}

// CHECK: ChoreoFunction
// CHECK:  `- Name: async_parallel_by
// CHECK:  `- Return type: void
// CHECK:  `- Parameters:
// CHECK:  `- Parallelization:  index symbol: anon_4, bound [0, 3)

__co__ void dyn_pb(int up, int uq) {
  parallel p by up, q by uq {}
}

// CHECK: ChoreoFunction
// CHECK:  `- Name: dyn_pb
// CHECK:  `- Return type: void
// CHECK:  `- Parameters:
// CHECK:    `-  type: s32, symbol: up
// CHECK:    `-  type: s32, symbol: uq
// CHECK:  `- Parallelization: index symbol: p, bound [0, up)
// CHECK:   `- Parallelization: index symbol: q, bound [0, uq)
